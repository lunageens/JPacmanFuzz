<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Jpacman Fuzzing report - Home</title>
    <!-- * Changed paths -->
    <link href="../../../../dist/css/mystyles.css" rel="stylesheet">
    <script src="../../../../dist/js/http_kit.fontawesome.com_6fcea80876.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
</head>
<body>
<div id="main-container" class="container is-fluid">
    <div class="block">
        <!-- Section above with breadcrumbs, header and search bar -->
        <!-- * No changes -->
        <div id="Top" class="hero has-background-white mb-0">
            <div class="hero-body py-1 pb=2">
                <!-- Breadcrumbs and logo -->
                <div id="breadcrumbs-logo" class="level mb-0">
                    <div class="level-left">
                        <div id="logo" class="level-item">
                            <div class="figure">
                                <div class="figure-img">
                                    <img width="100" height="100"
                                         src="https://img.icons8.com/bubbles/100/000000/pacman--v1.png"
                                         alt="pacman--v1"/>
                                </div>
                            </div>
                        </div>
                        <div class="level-item mt-0">
                            <!-- BreadCrumbs -->
                            <!--  ? do i need to change these paths? -->
                            <div id="breadcrumbs-field" class="field">
                                <nav aria-label="breadcrumbs" class="breadcrumb">
                                    <ul>
                                        <li>
                                            <a href="welcomePage.html">
        <span class="icon is-small">
          <i aria-hidden="true" class="fas fa-ghost"></i>
        </span>
                                                <span>Welcome</span>
                                            </a>
                                        </li>
                                        <li class="is-active">
                                            <a class="has-text-weight-bold" href="home.html">
        <span class="icon is-small">
          <i aria-hidden="true" class="fa-solid fa-table"></i>
        </span>
                                                <span>Home</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="aboutTheFuzzer.html">
        <span class="icon is-small">
          <i aria-hidden="true" class="fa-solid fa-quote-left"></i>
        </span>
                                                <span>About the fuzzer</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="overviewAndConclusions.html">
        <span class="icon is-small">
          <i aria-hidden="true" class="fa-solid fa-lightbulb"></i>
        </span>
                                                <span>Overview report and conclusions</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="allMaps.html">
        <span class="icon is-small">
          <i aria-hidden="true" class="fa-regular fa-file-lines"></i>
        </span>
                                                <span>All maps</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="https://github.com/lunageens/JPacmanFuzz">
                                <span class="icon is-small">
                                    <i aria-hidden="true" class="fa-brands fa-github"></i>
                                </span>
                                                <span>Download</span>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header-->
                <br>
                <div id="header-field" class="field">
                    <article class="message is-info" id="message">
                        <div class="message-header">
                            <p class="label">Jpacman Fuzzing report</p>
                            <button aria-label="delete" class="delete" id="message-exit-button"></button>
                        </div>
                        <div class="message-body">
                            This report provides an overview of the <strong>JPacman</strong> fuzzing results. Fuzzing,
                            also known as fuzz testing or fuzzing, is a software testing technique used to discover
                            vulnerabilities and flaws in software systems. It involves providing invalid, unexpected, or
                            random data inputs to a program or system and observing how it behaves. In this case, the
                            fuzzing is applied to a black-box Jpacman application jar-file.
                        </div>
                    </article>
                </div>
                <!--SearchBox-->
                <br>
                <div id="searchbox-field" class="field">
                    <p class="control has-icons-left">
                        <label for="search-bar"></label>
                        <input class="input is-info is-hovered is-rounded" id="search-bar" placeholder="Search..."
                               type="text">
                        <span class="icon is-left">
                <i class="fas fa-magnifying-glass"></i>
            </span>
                    </p>
                </div>
                <br>
            </div>
        </div>

        <!-- Filters-->
        <div class="hero mt-0 pt-0">
            <div class="hero-body mt-0">
                <div class="block">
                    <div id="filterText-activeFilters-filters" class="field" style="width:100%">

                        <div id="filterBox" class="box">
                            <section id="filterText" class="section ">
                                <h1 class="title has-text-info has-text-weight-bold">Filters</h1>
                                <h2 class="subtitle">Pick any filters u want to apply on the
                                                     datatable.</h2>

                                <section id="activeFiltersSection" class="section" style="display: none;">

                                    <h2 class="subtitle is-inline">Active
                                                                   filters: </h2>

                                    <div id="activeFilters" class="column is-inline"></div>
                                </section>
                                <div id="filters" class="columns is-12 is-multiline">
                                <!-- * Add Filters here -->
                                <!-- ? If I change id here I need to change header column as well? Make sure to have proper ids-->
                                <!-- ! Do not forget All -->
                                <!-- In CSV File: fuzzAttemptNr, Data and Time, Iteration Number, Exit Code, Output messages,
                                action Sequence, map File type, Map file custom attribute,
                                Absolute path, relative path -->
                                <!-- Skip timeStamp as filter but not in table, make this hidden not delete (otherwise filters will not work) -->
                                <!-- Skip relative path in both table and filter -->
                                <!-- Change format map file name to without extension -->
                                <!-- Change format exitCode with full text in filters and table -->
                                <!-- Change format map file type to one word only in filters and table -->
                                {{Filters}}
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DataTable-->
        <div class="hero my-0 pt-0">
            <div class="hero-body mt-0 pt-0">
                <div class="block">
                    <div id="resultsText-results-pagination" class="field">

                        <div id="resultsBox" class="box">
                            <section id="resultsText" class="section has-text-left">
                                <h1 class="title has-text-info has-text-weight-bold">Results</h1>
                                <h2 class="subtitle">These were the results of the latest fuzzes. Click on the
                                                     headers to
                                                     sort.</h2>
                            </section>
                            <br>
                            <div id="results" class="columns">
                                <div class="column is-12">
                                    <div class="table-container">
                                        <table id="myTable"
                                               class="table is-narrow is-hoverable is-fullwidth is-paddingless is-responsive"
                                               style="white-space: nowrap">
                                            <thead id="headersTable">
                                            <tr>
                                                <!-- * Add headers here -->
                                                <!-- ! Make sure to have same headers as ID filters -->
                                               {{Headers}}
                                            </tr>
                                            </thead>
                                            <tbody id="bodyTable">
                                            <!-- * Add Results here -->
                                            <!-- ! For Absolute file path, class="is-link has-background grey-lighter" and in that, <a href=allMaps.html#collapsible-card{$Index?}>{$file-path]</a> -->
                                            <!-- Make sure to have same id's in all maps -->
                                            {{DataTable}}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div id="pagination" class="level">
                                <div class="level-item is-relative">
                                    <div class="level-item">
                                        <nav class="pagination is-rounded is-centered" role="navigation"
                                             aria-label="pagination">
                                            <a id="previousPage" class="pagination-previous">Previous</a>
                                            <ul id="pageNumbers" class="pagination-list">
                                                <li><a id="firstPage" class="pagination-link"
                                                       aria-current="true"
                                                       aria-label="Goto page 1">1</a></li>
                                                <li><span id="firstPoints"
                                                          class="pagination-ellipsis">&hellip;</span>
                                                </li> <!-- Range separators -->
                                                <li><a id="currentPageNumber"
                                                       class="pagination-link is-current"
                                                       aria-label="Page 46" aria-current="page">46</a></li>

                                                <li><span id="secondPoints"
                                                          class="pagination-ellipsis">&hellip;</span>
                                                </li>
                                                <li><a id="lastPage" class="pagination-link"
                                                       aria-label="Goto page 86">86</a>
                                                </li>
                                            </ul>
                                            <a id="nextPage" class="pagination-next">Next page</a>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <!-- * Path changed -->
        <br>
        <footer id="footer" class="footer">
            <div class="content has-text-centered">
                <p>
                    <strong>JPacman Fuzz</strong> by Luna Geens as part of an assignment for the <a
                        href="https://ansymore.uantwerpen.be/courses/software-testing">Software Testing
                                                                                       Course</a> of
                                                  the <a href="https://www.uantwerpen.be/en/">University of
                                                                                              Antwerp</a>.
                                                  Find the source code of the
                                                  JPacman Fuzzer on my <a
                        href="https://github.com/lunageens/JPacmanFuzz">Github</a>.
                </p>
                <figure> <!-- Changed paths -->
                    <img height="50" src="../../../../dist/img/Logo_Univ_Antwerpen.svg"
                         width="50" alt="Logo of University of Antwerp">
                    <img height="50" src="../../../../dist/img/Logo_Bulma.svg" width="30" alt="Logo of Bulma">
                    <figcaption>
                        Website made with Bulma for the University of Antwerp.
                    </figcaption>
                </figure>
            </div>
        </footer>

    </div>
</div>
<!-- * No changes -->
<script>
    // Function to handle filter change
    function handleFilterChange() {
        const allFilters = Array.from(document.getElementsByClassName('filter')).map(filter => filter.value)
        console.log("allFilters: ")
        console.log(allFilters)
        const nonEmptyFilterIndexes = allFilters.reduce((indexes, value, index) => {
            if (value !== '') {
                indexes.push(index);
            }
            return indexes;
        }, []);
        console.log("nonEmptyFilterIndexes: ")
        console.log(nonEmptyFilterIndexes)
        // Get all selected filter values
        const selectedFilters = Array.from(document.getElementsByClassName('filter'))
                .map(filter => filter.value)
                .filter(value => value !== "");
        console.log("selectedFilters: ")
        console.log(selectedFilters)
        // Apply filtering based on selected filter values
        const rows = Array.from(document.querySelectorAll('.table tbody tr'));
        rows.forEach(row => {
            const cells = Array.from(row.getElementsByTagName('td')); // Get all cells in that row
            const shouldShow = selectedFilters.every((value, index) => { // Should this row be shown?
                console.log("value: ")
                console.log(value)
                console.log("index: ")
                console.log(index)
                var indexTable = nonEmptyFilterIndexes[index]
                console.log("indexTable: ")
                console.log(indexTable)
                console.log("cells: ")
                console.log(cells)
                console.log("cells[indexTable: ")
                console.log(cells[indexTable])
                return cells[indexTable].textContent.trim() === value // If the cell on place x has ... that is the same that value on place xxx
            }); // Index is number of filter
            row.style.display = shouldShow ? "table-row" : "none";
        });
        updateActiveFilters(selectedFilters, nonEmptyFilterIndexes);
    }

    // Function to remove a filter
    function removeFilter(filter) {
        const filters = Array.from(document.getElementsByClassName('filter'));
        filters.forEach(filterElement => {
            if (filterElement.value === filter) {
                filterElement.value = "";
            } // Value of all option
        });
        handleFilterChange();
    }

    // Function to update the active filters section according to selected filters
    function updateActiveFilters(filters, list) {
        // Get all filter names
        const headerCells = Array.from(document.querySelectorAll('.table thead th'));
        const filterNames = headerCells.map(cell => cell.textContent.trim());
        // Get section we need to alter
        const activeFiltersSection = document.getElementById('activeFiltersSection');
        const activeFiltersElement = document.getElementById('activeFilters');
        activeFiltersElement.innerHTML = "";
        // If there are active filters, show section and add the correct active filters elements.
        if (filters.length > 0) {
            activeFiltersSection.style.display = "block"; // Show whole section
            activeFiltersSection.className = "tags";
            filters.forEach((filter, index) => { // And add active filter elements to that section
                if (filter.value !== "") { // Control
                    // Create new active filter overall element
                    const filterElement = document.createElement('span');
                    filterElement.className = "tag is-rounded is-medium";
                    const filterIndex = list[index]; // Get correct header name of chosen filter value
                    filterElement.textContent = " " + filterNames[filterIndex] + ": " + filter + " ";

                    const removeButton = document.createElement('button');
                    removeButton.className = "delete";
                    removeButton.addEventListener('click', () => {
                        removeFilter(filter);
                    });
                    filterElement.append(removeButton)


                    // Add overall active filter element to our active filters section
                    activeFiltersElement.appendChild(filterElement);
                }
            });
        } else {
            // Don't show
            activeFiltersSection.style.display = "none";
        }
    }

    // Function to hide the message in header
    function hideMessage() {
        const message = document.getElementById("message");
        message.style.display = "none";
    }

    // Function to handle the exit button click of message in header
    function handleExitButtonClick() {
        hideMessage();
        localStorage.setItem("hideMessage", "true");
    }

    // Wait for the document to finish loading to add to hideMessage() and handleExitButtonClick() to right elements
    // Initialize data table and add correct action events to filters
    document.addEventListener("DOMContentLoaded", function () {
        $(document).ready(function () {
            // Initialize datatable
            // Remove searching bar jquery - l = length changing input control, r= processing display element, and also pagination
            const table = $('#myTable').DataTable(
                    {   // Show x entries
                        lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        pageLength: 25,
                        // Paging
                        paging: true,
                        pagingType: "full_numbers",
                        // Searching. Use editor sDom  -> shadow dom
                        searching: true,
                        sDom: 'lrrti',
                        // Ordering
                        ordering: true,
                        stateSave: true,
                        // How to do scroll? -> not on wide screen bcs table is big but on others works
                        "sScrollX": "100%",
                        "sScrollXInner": "100%",
                        "bScrollCollapse": true,
                    }
            )
            // Add extra buttons to the pagination, and every time you draw, add them again (new page nr)
            addExtraButtons();
            table.on("draw.dt", function () {
                addExtraButtons();
            })
            // Add event listener to our own search bar
            const searchBar = document.getElementById('search-bar');
            searchBar.addEventListener('input', () => {
                table.search(searchBar.value).draw();
            });

            // This function here instead of above -> needed when loaded?
            function addExtraButtons() {
                // Buttons next page and previous page and their action listeners
                const nextPage = document.getElementById('nextPage');
                const previousPage = document.getElementById('previousPage');
                nextPage.addEventListener("click", quickNext)
                previousPage.addEventListener("click", quickPrevious)

                // Current page variable of the table. Make buttons above disabled if needed, based on that
                var currentPage = table.page.info();
                // page starts from 0. pages from 1. On last page.
                if (currentPage.pages === currentPage.page + 1) {
                    nextPage.setAttribute('disabled', '');
                }
                else {
                    nextPage.removeAttribute('disabled');
                }
                if (currentPage.page === 0) {
                    previousPage.setAttribute('disabled', '');
                }
                // On first page.
                else {
                    previousPage.removeAttribute('disabled');
                }

                // Number current page
                const currentPageNumberElement = document.getElementById('currentPageNumber');
                currentPageNumberElement.textContent = currentPage.page + 1;

                // Numbers first and last page. Draw table on the right page when clicked.
                const firstPageNumberElement = document.getElementById('firstPage');
                firstPageNumberElement.addEventListener("click", function () {
                    table.page(0).draw(false);
                })
                const lastPageNumberElement = document.getElementById('lastPage');
                lastPageNumberElement.textContent = (currentPage.pages).toString();
                lastPageNumberElement.addEventListener("click", function () {
                    table.page(currentPage.pages - 1).draw(false);
                })
            }

            function quickNext() {
                var currentPage = table.page.info();
                var pageToGoTo = (currentPage.page + 2) >= currentPage.pages ? currentPage.pages - 1 : (currentPage.page + 2);
                table.page(pageToGoTo).draw(false);
            }

            function quickPrevious() {
                var currentPage = table.page.info();
                var pageToGoTo = (currentPage.page - 2) <= 0 ? 0 : (currentPage.page - 2);
                table.page(pageToGoTo).draw(false);
            }

        });

        // Add event listeners to exit button
        const exitButton = document.getElementById("message-exit-button");
        if (localStorage.getItem("hideMessage") === "true") {
            hideMessage();
        }
        exitButton.addEventListener("click", handleExitButtonClick);
        window.addEventListener("beforeunload", function () {
            localStorage.removeItem("hideMessage");
        });

        // Add toggle event listeners
        $('.collapse-toggle').click(function () {
            $(this).closest('tr').next('.collapse-row').toggleClass('is-hidden');
        });

        // Add event listeners to filters
        const filters = Array.from(document.getElementsByClassName('filter'));
        filters.forEach(filter => filter.addEventListener('change', handleFilterChange));
    });

</script>
</body>
</html>